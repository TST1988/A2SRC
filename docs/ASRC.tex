\documentclass[paper=a4, pagesize, twoside, openright, draft=false,
BCOR7mm, DIV13, fontsize=11pt, headings=normal, footinclude=false, 
chapterprefix = false, toc=listof, ngerman, parskip=half]{scrartcl} % doppelseitiger Druck

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage{D:/Daten/tex/dsvFPGA_ueb_style_v3}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%\includeonly{2010-DSP_FPGA-Ueb_Kap_1_2}
%
\hypersetup{
pdftitle={Asynchronous Sample Rate Conversion},
                   pdfauthor={Christian Muenker},
                   pdfsubject={Asynchronous Sample Rate Conversion},
                   pdfkeywords={SRC, ASRC, Python}
                   }
\def\CodePath{scripts/}
\def\pyFirstLine{31}
\def\mlFirstLine{20}
%
%
\begin{document}
%\renewmdenv[linecolor=red,frametitle={Wichtige Begriffe}]{infobox}

%\frontmatter
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\author{Prof. Dr. Christian Münker, Florian Thevissen}
\title{Interpolation und Asynchronous Sample Rate Conversion}
\date{\today}
%\maketitle
\begin{titlepage}
\begin{center}
\begin{Huge}Asynchronous Sample Rate Conversion\end{Huge}\\[1cm]
\begin{huge}ASRC\end{huge}
\\[1cm]
\LARGE Prof. Dr. Christian M\"unker
\vfill
\includegraphics[width=13cm]{img/KaiserIR.png}

\footnotesize{sinc-Funktion}
\vfill
\Large \today \\[1cm]
\href{mailto:Christian.Muenker@hm.edu}{Christian.Muenker@hm.edu}
\end{center}
\end{titlepage}

%
%***********************************************************************%
%*******               TABLE OF CONTENTS                        ********%
%***************                                        ****************%
\clearpage
\phantomsection % needed for correct TOC and hyperlinks
\tableofcontents
\addcontentsline{toc}{section}{Inhaltsverzeichnis}

%
%\def\thesection{\arabic{chapter}.\arabic{section}} 
%\include{DSP_FPGA-Ueb_Changes}
%\addcontentsline{toc}{chapter}{Änderungen}

%\def\thesection{Aufgabe \arabic{chapter}.\arabic{section}} 

%\setcounter{lofdepth}{2} % List of figures mit subfigures


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\setcounter{topnumber}{3} % max. Anzahl von Gleitobjekten im oberen Teil der Seite

\section{Überblick}
Mit dem Siegeszug der digitalen Signalverarbeitung stellte sich rasch das stellte sich rasch das Problem, Mess-, Audio-, Foto- und Videoformaten zwischen verschiedenen Abtastraten (bzw. Auflösungen bei Fotos und Videos) möglichst verlustarm zu konvertieren. Diese Problematik ist eng verwandt mit Techniken der \textit{Interpolation}, also der Problemstellung zu einer Reihe von Zahlenwerten verlässliche Zwischenwerte zu ermitteln. \cite{Meijering2002} beschreibt die lange Geschichte der Interpolation von der Antike bis in das 20. Jahrhundert und ordnet sie so in einen größeren Kontext ein.

Eine ingenieurnahe Weise diesen Prozess zu betrachten ist: Interpolation erzeugt eine kontinuierliche Funktion aus einer Anzahl von diskreten Stützstellen. Diese Funktion ist an jedem Punkt auswertbar und stimmt an den Stützstellen mit diesen exakt (ZOH, lineare, quadratische, kubische Interpolation) oder näherungsweise (Spline-Interpolation) überein. Man kann einen Interpolator also auch als Filter mit zeitdiskreter Eingangsfolge und zeitkontinuierlichem Ausgangssignal betrachten (dem dann die neuen Werte zu den gewünschten Zeitpunkten entnommen werden). Allerdings ist diese Betrachtung des Resampling Prozesses in der \textit{Zeitebene} für Audiosignale suboptimal, eine Darstellung der o.g. Interpolationsalgorithmen in der Frequenzebene führt für Interpolatoren höherer Ordnung (Spline, kubisch) zu komplizierten Ausdrücken.

Dieses Paper fokussiert sich auf \textit{Real-Time Abtastratenwandlung von Audiosignalen} in Software und Hardware, also \textit{bandbegrenzten} Signalen. 

Weitere wichtige Aspekte sind dabei die effiziente Implementierung von Interpolation sowie Verfahren/Metriken, die Qualität der Ausgangssignale zu bewerten.

Für Audiosignale ist es u.U. sinnvoller, sich dem Thema direkt in der Frequenzebene zu nähern. Diesen Ansatz verfolgen 

\textbf{Julius O. Smith} mit ("`Simulated Analogue Filter Method"'), "`Digital Audio Resampling Home Page"' (\url{https://ccrma.stanford.edu/~jos/resample/resample.html}, auch als pdf). Das Skript zur Vorlesung findet sich in \cite{Smith2011}. 

Ein weiteres gutes Skript zu xxx ist von \cite{Babic}. Unter \cite{Lehtinen2004} findet sich eine interessante Gegenüberstellung unterschiedlicher Modelle von Interpolationsfiltern. In \cite{Schafer1973} gibt Ronald Schafer schließlich eine gute Übersicht über Interpolation in der Signalverarbeitung, Abtastratenkonvertierung, Lagrange Interpolatoren und über den Entwurf von FIR Interpolationsfiltern.

\textbf{Evangelista} hat in seiner Dissertation \cite{Evangelista2000} ein mathematisches Modell für Abtastratenwandler vorgestellt und der Entwurf von Interpolatoren behandelt, immer mit Blick auf die Implementierbarkeit. Die Herangehensweise ist dabei (nur) so mathematisch wie es die Thematik erfordert und nicht unbedingt für den Einstieg geeignet.

\cite{Lokken2005} unterscheidet zwischen "`arbitrary sample rate conversion"' (ASRC) und "`asynchronous arbitrary sample rate conversion"' (AASRC), Evangelista redet von Generalized Arbitrary Sample Rate Conversion.

\begin{infobox}
\begin{description}
\item [Sample Rate] (Abtastrate) die Rate, mit der ein zeitdiskretes Signal vorliegt
\item [Upsampling] Erhöhen der Abstastrate um einen ganzzahligen Faktor, die fehlenden Samples werden durch Null gefüllt (zero-stuffing) oder durch Wiederholen des letzten Werts (Zero-Order Hold). Dabei entstehen Kopien des ehemaligen Basisbands bis zur neuen -> Nyquistfrequenz, sog. -> Images, die durch Anti-Image Filter entfernt werden müssen. 
\item [Downsampling] Verringerung der Abtastrate um einen ganzzahligen Faktor durch Weglassen von Abtastwerten. Ohne vorherige Bandbreitenbegrenzung (Anti-Alias Filterung) besteht die Gefahr von -> Aliasing.
\item [Resampling]
\item [Synchron] wenn sich das Verhältnis von zwei Abtastraten durch ein einfachen Bruch ausdrücken lässt, z.B. beim Resampling von 44.1kHz nach 48kHz, 44.1/48 = 147 / 160 .
\item [Asynchron] wenn die zwei Abtastraten kein einfaches rationales Verhältnis haben
\end{description}
\end{infobox}

\begin{description}

\item [Uri Nieto] Audio Resampling in Python, \url{http://urinieto.com/2011/05/audio-resampling-in-python/}
\end{description}


\section{Interpolationsverfahren}

\subsection{Zero-Order Hold Interpolation}

\subsection{Lineare Interpolation}

\subsection{Quadratische Interpolation}

\subsection{Spline-Interpolation}

\section{Simulation und Modellierung}

\section{Bewertung der Qualität}
Übliche Maßzahlen zur Bewertung der Qualität eines Abtastratenwandlers sind:
\begin{description}
\item [Signal-to-Noise Ratio (SNR):] Eine Maßzahl dafür, wieviel Störungen der Umwandlungsprozess dem Signal hinzufügt (gemessen in dB). 
\item [Bandbreite:] Tiefpassfilterung ist ein unvermeidlicher Bestandteil jeder Ratenwandlung; abhängig von der Ordnung des verwendeten Filters wird dabei das Signalband mehr oder weniger stark beschnitten.
\item [Geschwindigkeit / Rechenaufwand:] Vor allem für Real-Time Anwendungen ist ein minimaler Rechenaufwand essenziell.
\end{description}

Bei den meisten Verfahren zur Abtastratenwandlung hängt die Qualität ab von der Frequenz des Eingangsssignals und dem Verhältnis zwischen Eingangs- und Ausgangsabtastrate.
    

Das Infinite Wave Masteringstudio hat unter \url{http://src.infinitewave.ca/} einen sehr umfassenden Vergleich verschiedener ASRC Softwareimplementierungen in Betriebssystemen und Audio-Software bereit gestellt. Unter Help finden sich viele nützliche Informationen. Die Implementierungen wurden bewertet nach

\begin{description}
\item [Verzerrungen und Aliasing:] Mit Hilfe eines Sweeps zwischen 0 und 48 kHz sieht man schnell, welches Maß an Verzerrungen und Aliasing bei welchen Eingangsfrequenzen auftritt. Mit einem 1~kHz Testtons bei -0.1~dBFS und -60~dBFS sieht man detailliert, bei welchen Frequenzen Verzerrungen anfallen und wo Quantisierungseffekte auftreten.  
\item [Frequenzgang im Pass- und Stoppband:] Eine ungenügende Dämpfung im Stoppband führt zu Aliasing, Variationen im Passband beeinflussen das Nutzsignal.
\item [Impulsantwort:] Der Impulsantwort kann man entnehmen, wie steilbandig das Filter ist (starkes Ringing), ob das Filter linearphasig ist (konstante Gruppenlaufzeit) oder minimalphasig (geringes Pre-Ringing). Nicht-linearphasige Filter können die Lokalisierbarkeit von Audioquellen beeinträchtigen, minimalphasige Filter haben dafür weniger Einschwingen / Klingeln vor dem eigentlichen Audio-Event (z.B. Snare-Schlag). 
\item [Phasengang / Gruppenlaufzeit:] Aus dem Phasengang kann man ähnliche Ergebnisse ableiten wie aus der Impulsantwort.
\item [SNR] wurde hier nicht verglichen, diese Maßzahl ist für sich auch nicht besonders aussagekräftig.
\end{description}

\begin{figure}
\centering
\subfigure[]{
\includegraphics[width = 0.45 \linewidth]{infinitewave_burner16_sweep}
}
\subfigure[]{
\includegraphics[width = 0.45 \linewidth]{infinitewave_burner16_1kHz}
}

\caption{Performance eines Sample Rate Converter bei der Umwandlung 96~kHz -> 44.1~kHz, (a) sine chirp, (b) 1~kHz sine}
\label{fig:SRC_comparison}
\end{figure}

%\begin{figure}[ht]
%\centering
%\includegraphics[width = 0.8\textwidth]{ueb-PY-git-local-remote}
%\caption{Grundlegende Git - Operationen [\url{http://www.terminus-notfallmedizin.de/blog/?p=824}]}
%\label{fig:Py-git-local-remote}
%\end{figure}



\section{Literatur}

Da das Konzept der Interpolation in den verschiedensten Zusammenhängen verwendet wird, ist die mathematische Behandlung auch dementsprechend verschieden. Zwischen den folgenden Konzepten sollten meiner Meinung nach unterschieden werden:

\begin{quote}\begin{description}
	\item[Fractional-Delay-Filter:] Ein Interpolator, aus dessen kontinuierlichem Ausgangssignal nur ein Wert entnommen wird  
	\item[Interpolationsfilter:] Filter zum Entfernen der Images bei Aufwärtstastung um einen ganzzahligen Faktor
	\item[Effiziente Strukturen:] Polyphasen-Filter, Farrow-Filter 
	\item[Abtastratenwandler:] Systeme bestehend aus Auf- bzw. Abwärtstastern, Filtern und/oder Interpolatoren
\end{description} \end{quote} 

\vspace{1mm}

\subsection*{Interpolationstheorie}

In \cite{Pinkus} geht es um die  Anfänge der Approximationstheorie nach Weierstraß. In \cite{Fomel2000} fand ich zum ersten Mal
eine funktionanalytische Beschreibung der Interpolation mithilfe von Basisfunktionen - eine Herangehensweise, die zum Verständnis der Interpolation mittels B-Splines wichtig ist.

\subsection*{Interpolatoren}

Zum Entwurf von Lagrange Interpolatoren erfährt man etwas in \cite{Schafer1973} und \cite{Ye2003}. Eine gute Übersicht über 
B-Splines gibt Michael Unser in seinen Papers, z.B. zum Einstieg in das Thema in \cite{Unser1999}, oder in \cite{Unser1993c} und \cite{Unser1993b}. Der Zusammenhang
zwischen kardinalen B-Splines und deren Konvergenz gegen den idealen bandbegrenzten Interpolator wird in \cite{Aldroubi1992} behandelt. 
Auch die bereits erwähnte Dissertation \cite{Evangelista2000} sowie ein daraus abgeleitete Journal Paper \cite{Evangelista2003} behandeln den Entwurf von Interpolatoren.

\subsection*{Implementierung von Interpolatoren}

Zur Implementierung eines Interpolators auf einem FPGA ist eine Abbildung der Theorie auf eine effiziente Hardware-Struktur nötig. In seinem Buch behandelt Fredric Harris
einige Aspekte der Implementierung von Polyphasen- und Farrow-Filtern in Hardware \cite{Harris2004}.
In \cite{Smith1993} entwickelt Steven Smith eine an der Praxis orientierte Methode, ideale bandbegrenzte Interpolation zu approximieren und mit 
Lookup-Tables zu implementieren. \cite{Farrow1988} ist das berühmte Paper von C. Farrow, in dem er das Farrow-Filter zur effizienten Implementierung
von polynomialen Filtern vorstellt. In \cite{Nit2009} wird ein Fractional-Delay-Filter auf einem FPGA in einer aufwandsarmen Struktur realisiert. 
In \cite{Unser1993b} behandelt Michael Unser die Implementierung von B-Spline Interpolatoren. In \cite{Francesconi1993} und \cite{Francesconi1993a}
wird eine Struktur von Lagrange Interpolatoren vorgestellt, die ohne Multiplizierer auskommt.

\subsection*{Anwendungen von Interpolatoren}

Interpolatoren kommen nicht nur in Abtastratenwandlern zum Einsatz, sondern auch in der Bildverarbeitung \cite{Unser1995}, 
und Medizintechnik \cite{Lehmann2001}. Sie werden auch dazu verwendet, um mit einer kontinuierlichen Form eines Signals zu rechnen
 \cite{Babic}. In \cite{Niemitalo2001} findet sich ein sehr interessanter Vergleich verschiedener Polynom-Interpolatoren zum Resampling von überabgetasteten (oversampled)
Audio Signalen.  

\subsection*{Entwurf von Abtastratenwandlern}

Ein Interpolator ist ein Teil-System eines Abtastratenwandlers. Er ist im einfachsten Falle ein Zero-Order-Hold. In \cite{Lokken2005} gibt Ivar Løkken 
einen einfachen Einstieg in den Entwurf von mehrstufigen Wandlern mit Zero-Order-Hold, und in Grundzügen auch, mit First-Order-Hold Interpolatoren. In \cite{Crochiere1981}
geht es um Ähnliches. Unter \cite{infinitewave_a} finden sich interessante Tests verschiedener Wandler. 

\subsection*{FFT-basierte Spektralanalyse, Fensterung}

Die Bestimmung des SNRs der von mir in Python modellierten Wandler machte es notwendig, mich im Detail mit FFT basierter Spektralanalyse, und der Fensterung von Signalen
zu beschäftigen. \cite{Heinzel2002} gibt zu beiden Themen eine gute Übersicht. Das Paper von Fredric Harris unter \cite{Harris1978} ist das Standardwerk zum Einsatz 
von Fenstern. Unter \cite{Hoffmann2007} findet sich eine ausführliche Erklärung des Zusammenhangs zwischen Leistungsdichte-Spektrum und Leistungs-Spektrum im Spectrum-Scope
Block von Simulink, und in \cite{Narcowich1998} wird die Fourier-Transformierte einer Funktion durch die DFT approximiert.
\newpage
\bibliographystyle{D:/Daten/tex/bib/amsalpha_initial} % Choose style for bibliography
\bibliography{asrc}
\end{document}


\end{document}
